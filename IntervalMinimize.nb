(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     69109,       1734]
NotebookOptionsPosition[     68153,       1700]
NotebookOutlinePosition[     68586,       1717]
CellTagsIndexPosition[     68543,       1714]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[TextData[{
 "This notebook contains code for several of the functions used in Chapter 4. \
The code is meant to be used as one piece, meaning that all the code in the \
",
 StyleBox["Utilities",
  FontWeight->"Bold"],
 " and ",
 StyleBox["Main Functions",
  FontWeight->"Bold"],
 " section should be loaded. Any questions about this code should be directed \
to Stan Wagon, wagon@macalester.edu."
}], "Text",
 CellChangeTimes->{{3.709409085731908*^9, 3.709409091004118*^9}},
 ExpressionUUID -> "9bbfd0fd-5461-4e5b-b5a0-534bed1d880c"],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{
  3.7089678483402367`*^9, {3.709409093788744*^9, 3.7094090946521063`*^9}},
 ExpressionUUID -> "b65d0aea-88f4-4e04-9541-05b93d0c5718"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Warning", ":", " ", 
    RowBox[{
    "Interval", " ", "sometimes", " ", "has", " ", "the", " ", "form", " ", 
     RowBox[{"Interval", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "b"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"c", ",", "d"}], "}"}]}], "]"}], " ", "indicating", " ", 
     "disjoint", " ", 
     RowBox[{"intervals", ".", " ", "Not"}], " ", "all", " ", "the", " ", 
     "code", " ", "here", " ", "takes", " ", "that", " ", "into", " ", 
     RowBox[{"account", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Off", "[", 
     RowBox[{"General", "::", "\"\<spell1\>\""}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DigitsAgreeCount", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"prec", "=", 
        RowBox[{"Ceiling", "@", 
         RowBox[{"Min", "[", 
          RowBox[{"Precision", "/@", 
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}]}], "]"}]}]}], ";", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ad", ",", "ae"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"bd", ",", "be"}], "}"}]}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"RealDigits", "[", 
           RowBox[{"#", ",", "10", ",", "prec"}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"a", ",", "b"}], "}"}]}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ae", "\[NotEqual]", "be"}], "\[Or]", 
          RowBox[{
           RowBox[{"a", " ", "b"}], "\[LessEqual]", "0"}]}], ",", 
         RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ad", "\[Equal]", "bd"}], ",", 
         RowBox[{"Return", "@", 
          RowBox[{"Length", "[", "ad", "]"}]}]}], "]"}], ";", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "com", "}"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"MapThread", "[", 
            RowBox[{"Equal", ",", 
             RowBox[{"{", 
              RowBox[{"ad", ",", "bd"}], "}"}]}], "]"}], ",", "False", ",", 
           "1", ",", "1"}], "]"}], "-", "1"}]}], ";", "com"}], ")"}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DigitsAgreeCount", "[", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], "]"}], "]"}], ":=", 
     RowBox[{"DigitsAgreeCount", "[", 
      RowBox[{"a", ",", "b"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalForm", "[", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], "]"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"com", "=", 
            RowBox[{"DigitsAgreeCount", "[", 
             RowBox[{"a", ",", "b"}], "]"}]}], ")"}], "\[Equal]", "0"}], ",", 
         
         RowBox[{"Return", "@", 
          RowBox[{"Interval", "[", 
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}], "]"}]}]}], "]"}], ";", 
       RowBox[{"start", "=", 
        RowBox[{
         RowBox[{"Sign", "[", "a", "]"}], " ", 
         RowBox[{"N", "[", 
          RowBox[{
           RowBox[{"FromDigits", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ad", "\[LeftDoubleBracket]", 
               RowBox[{"Range", "@", "com"}], "\[RightDoubleBracket]"}], ",", 
              "1"}], "}"}]}], ",", "com"}], "]"}]}]}], ";", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"low", ",", "up"}], "}"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"SequenceForm", "@@", 
           RowBox[{"Take", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"com", "+", "1"}], ",", "prec"}], "}"}]}], "]"}]}], 
          "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"ad", ",", "bd"}], "}"}]}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ae", "\[Equal]", "0"}], ",", 
         RowBox[{
          RowBox[{"start", "/=", "10"}], ";", 
          RowBox[{"ae", "++"}]}]}], "]"}], ";", 
       RowBox[{"SequenceForm", "[", 
        RowBox[{
         RowBox[{"DisplayForm", "@", 
          RowBox[{"SubsuperscriptBox", "[", 
           RowBox[{
            RowBox[{"NumberForm", "@", "start"}], ",", "low", ",", "up"}], 
           "]"}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ae", "\[NotEqual]", "1"}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"{", 
             RowBox[{"\"\< \[Times] \>\"", ",", 
              RowBox[{"DisplayForm", "@", 
               RowBox[{"SuperscriptBox", "[", 
                RowBox[{"10", ",", 
                 RowBox[{"ae", "-", "1"}]}], "]"}]}]}], "}"}]}], ",", 
           "\"\<\>\""}], "]"}]}], "]"}]}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diam", "[", "X_", "]"}], ":=", 
     RowBox[{
      RowBox[{"Max", "[", "X", "]"}], "-", 
      RowBox[{"Min", "[", "X", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diam", "[", 
      RowBox[{"{", "X__Interval", "}"}], "]"}], " ", ":=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"diam", " ", "/@", " ", 
       RowBox[{"{", "X", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradient", "[", 
      RowBox[{"f_", ",", " ", "v_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{"f", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", "v"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ShowIntervals", "[", 
      RowBox[{"a_List", ",", " ", "opts___"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"PointSize", "[", ".025", "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Hue", "[", 
                    RowBox[{
                    RowBox[{"Random", "[", "]"}], ",", ".5", ",", ".7"}], 
                    "]"}], ",", 
                   RowBox[{"tt", "=", 
                    RowBox[{"Rectangle", "@@", 
                    RowBox[{"(", 
                    RowBox[{"tt", "=", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"#1", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], "]"}]}], ")"}]}]}]}], "}"}], ",", 
                 RowBox[{"Point", "[", 
                  RowBox[{".5", " ", 
                   RowBox[{"Plus", " ", "@@", " ", "tt"}]}], "]"}]}], "}"}]}],
               "}"}], "&"}], ")"}], "/@", "a"}], "]"}], ",", "opts"}], "]"}], 
       ")"}], "/;", 
      RowBox[{
       RowBox[{"Depth", "[", "a", "]"}], "==", "5"}]}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"containszerovector", "[", 
     RowBox[{"{", "i__Interval", "}"}], "]"}], ":=", 
    RowBox[{"And", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"IntervalMemberQ", "[", 
         RowBox[{"#", ",", "0"}], "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"{", "i", "}"}]}], ")"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"containszeronumber", "[", "z_Interval", "]"}], ":=", 
    RowBox[{"IntervalMemberQ", "[", 
     RowBox[{"z", ",", "0"}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"maxdim", "[", 
       RowBox[{"{", "i__Interval", "}"}], "]"}], ":=", " ", 
      RowBox[{"Max", "[", " ", 
       RowBox[{"diam", " ", "/@", " ", 
        RowBox[{"{", "i", "}"}]}], "]"}]}], ";"}], "  ", 
    RowBox[{"(*", " ", 
     RowBox[{"equal", " ", "to", " ", "diam"}], " ", "*)"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"subdivide", "[", 
      RowBox[{
       RowBox[{"{", "ints__Interval", "}"}], ",", " ", "wp_"}], "]"}], ":=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", 
          RowBox[{"{", "ints", "}"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", " ", "@@", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"ind", "[", "j", "]"}], ",", "0", ",", "1"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "n"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Interval", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", "ints", "}"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"k", ",", "1", ",", "1"}], "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ind", "[", "k", "]"}], ",", 
                    RowBox[{
                    RowBox[{"ind", "[", "k", "]"}], "+", "1"}]}], "}"}], 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", "ints", "}"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "1", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{
                    RowBox[{"{", "ints", "}"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "1", ",", "1"}], "]"}], "]"}]}], ")"}], 
                    "/", "2"}]}]}], "]"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"k", ",", " ", "n"}], "}"}]}], "]"}]}], "]"}]}], ",", 
           RowBox[{"n", "-", "1"}]}], "]"}], ",", "wp"}], "]"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"subdivide", "[", 
      RowBox[{
       RowBox[{"z_", "/;", 
        RowBox[{
         RowBox[{"Depth", "[", 
          RowBox[{"N", "[", "z", "]"}], "]"}], "\[Equal]", "5"}]}], ",", " ", 
       "wp_"}], "]"}], ":=", 
     RowBox[{"Join", " ", "@@", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"subdivide", "[", 
          RowBox[{"#", ",", " ", "wp"}], "]"}], " ", "&"}], " ", "/@", " ", 
        "z"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalContains", "[", 
      RowBox[{
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"a_", ",", " ", "b_"}], "}"}], "]"}], ",", " ", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"c_", ",", " ", "d_"}], "}"}], "]"}]}], "]"}], " ", ":=", 
     " ", 
     RowBox[{"a", "<", "c", "<", "d", "<", "b"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalContains", "[", 
      RowBox[{
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"a_", ",", " ", "b_"}], "}"}], "]"}], ",", " ", 
       RowBox[{"Interval", "[", "q__List", "]"}]}], "]"}], " ", ":=", "  ", 
     RowBox[{
      RowBox[{"And", " ", "@@", "\[IndentingNewLine]", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"IntervalContains", "[", 
           RowBox[{
            RowBox[{"Interval", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "b"}], "}"}], "]"}], ",", " ", 
            RowBox[{"Interval", "[", "#", "]"}]}], "]"}], "&"}], " ", "/@", 
         " ", 
         RowBox[{"{", "q", "}"}]}], ")"}]}], "/;", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"{", "q", "}"}], "]"}], ">", "1"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalContains", "[", 
      RowBox[{
       RowBox[{"{", "i1__Interval", "}"}], ",", " ", 
       RowBox[{"{", "i2__Interval", "}"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"And", " ", "@@", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"IntervalContains", " ", "@@", " ", "#"}], ")"}], "&"}], 
        " ", "/@", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "i1", "}"}], ",", " ", 
           RowBox[{"{", "i2", "}"}]}], "}"}], "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"combine", "[", "s_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"newseeds", "=", "s"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FreeQ", " ", "[", 
             RowBox[{
              RowBox[{"intervalintersectionbox", " ", "[", 
               RowBox[{
                RowBox[{"a", "=", 
                 RowBox[{"s", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                RowBox[{"b", "=", 
                 RowBox[{"s", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], ",", " ", 
              RowBox[{"Interval", "[", "]"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"newseeds", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"newseeds", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", 
              RowBox[{"intervalunionbox", "[", 
               RowBox[{"a", ",", "b"}], "]"}]}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", "  ", 
            RowBox[{
             RowBox[{"Length", "[", "s", "]"}], "-", "1"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"j", ",", " ", 
            RowBox[{"i", "+", "1"}], ",", " ", 
            RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Union", "[", "newseeds", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"intervalintersectionbox", "[", 
      RowBox[{
       RowBox[{"{", "i1__Interval", "}"}], ",", " ", 
       RowBox[{"{", "i2__Interval", "}"}]}], "]"}], ":=", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"IntervalIntersection", ",", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "i1", "}"}], ",", " ", 
          RowBox[{"{", "i2", "}"}]}], "}"}], "]"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"intervalunionbox", "[", " ", 
      RowBox[{
       RowBox[{"{", "i1__Interval", "}"}], ",", " ", 
       RowBox[{"{", "i2__Interval", "}"}]}], "]"}], " ", ":=", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"IntervalUnion", ",", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "i1", "}"}], ",", " ", 
          RowBox[{"{", "i2", "}"}]}], "}"}], "]"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rectToIteratorList", "[", 
      RowBox[{
       RowBox[{"{", "i__", "}"}], ",", " ", "vv_"}], "]"}], ":=", "  ", 
     RowBox[{"Flatten", " ", "/@", " ", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"vv", ",", " ", 
         RowBox[{"First", "/@", 
          RowBox[{"{", "i", "}"}]}]}], "}"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IteratorListToBox", "[", 
      RowBox[{"{", "i__", "}"}], "]"}], ":=", "  ", 
     RowBox[{"Interval", " ", "/@", " ", 
      RowBox[{"Rest", "/@", 
       RowBox[{"{", "i", "}"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"intervalmemberQbox", "[", 
      RowBox[{
       RowBox[{"{", "i__Interval", "}"}], ",", " ", "r_"}], "]"}], ":=", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"And", "@@", 
      RowBox[{"Apply", "[", 
       RowBox[{"IntervalMemberQ", ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "i", "}"}], ",", " ", "r"}], "}"}], "]"}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}]}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "midpoint", "]"}], "=", "Listable"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"midpoint", "[", "X_", "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Min", "[", "X", "]"}], "+", 
        RowBox[{"Max", "[", "X", "]"}]}], ")"}], "/", "2"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"midpoint", "[", 
      RowBox[{"x_", "?", "NumericQ"}], "]"}], " ", ":=", " ", "x"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "midpoint", "]"}], "=", "Listable"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "thirdpoint", "]"}], "=", "Listable"}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"thirdpoint", "[", "X_", "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", 
         RowBox[{"Min", "[", "X", "]"}]}], "+", 
        RowBox[{"Max", "[", "X", "]"}]}], ")"}], "/", "3"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"thirdpoint", "[", 
      RowBox[{"x_", "?", "NumericQ"}], "]"}], " ", ":=", " ", "x"}], ";"}], 
   StyleBox["\[IndentingNewLine]",
    FontColor->RGBColor[1, 0, 0]], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalToReal", "[", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], "]"}], "]"}], ":=", 
     FractionBox[
      RowBox[{"a", "+", "b"}], "2"]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalToReal", "[", 
      RowBox[{"Interval", "[", "]"}], "]"}], ":=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalToReal", "[", "l_List", "]"}], " ", ":=", " ", 
     RowBox[{"IntervalToReal", " ", "/@", " ", "l"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"IntervalToReal", "[", "a_", "]"}], ":=", "a"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RealToInterval", "[", 
      RowBox[{
       RowBox[{"r_", "?", "NumericQ"}], ",", "d_"}], "]"}], ":=", 
     RowBox[{"Interval", "[", 
      RowBox[{"r", "+", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}], " ", "d"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Attributes", "[", "RealToInterval", "]"}], " ", "=", " ", 
     "Listable"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RealToInterval", "[", 
      RowBox[{
       RowBox[{"v_", "?", "VectorQ"}], ",", "d_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"RealToInterval", "[", 
        RowBox[{"#", ",", " ", "d"}], "]"}], " ", "&"}], " ", "/@", " ", 
      "v"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MidRad", "[", 
      RowBox[{"x_", ",", "r_"}], "]"}], ":=", 
     RowBox[{"x", "+", 
      RowBox[{
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}], " ", "]"}], "r"}]}]}], 
    ";"}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{3.708967848342052*^9},
 ExpressionUUID -> "94836f58-661e-4c84-a329-683c969c3545"]
}, Closed]],

Cell[CellGroupData[{

Cell["The Krawczyk Operator", "Subsection",
 ExpressionUUID -> "daa8144d-fa3a-4c61-816c-61276b73de12"],

Cell["\<\
Code for the interval Newton operator is included too; Krawczyk is faster and \
is used throughout the routines later.\
\>", "Text",
 ExpressionUUID -> "5cb46738-43c6-4748-b065-a07bac10b136"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Krawczyk", "::", "usage"}], " ", "=", " ", 
     "\"\<Krawczyk[f, {x, a, b},..., jacobian] returns a triple: the first \
indicates whether the Krawczyk containment holds, the second is True if the \
Krawczyk image is disjoint from the given box, the third is the Krawczyk \
operator on the given box.\>\""}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"KrawczykQ", "::", "usage"}], " ", "=", " ", 
     "\"\<KrawczykQ[f, {x, a, b},..., jacobian] returns True if the Krawczyk \
condition holds on the given n-dimensional interval.\>\""}], ";"}], " ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NewtonBox", "::", "usage"}], " ", "=", " ", 
     "\"\<NewtonBox[f, {x,a,b},..., jacobianinv] returns a triple: the first \
indicates whether the Newton containment holds, the second is True if the \
Newton image is disjoint from the given box, the third is the Newton operator \
on the given box.\>\""}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Krawczyk", "[", 
      RowBox[{"f_", ",", " ", "i__List", ",", "jacobian_"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
       ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", "Y", ",", 
           RowBox[{"int", "=", 
            RowBox[{"IteratorListToBox", "[", 
             RowBox[{"{", "i", "}"}], "]"}]}], ",", 
           RowBox[{"vb", " ", "=", " ", 
            RowBox[{"First", " ", "/@", " ", 
             RowBox[{"{", "i", "}"}]}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"midpoint", "[", "int", "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"midjac", "=", 
           RowBox[{"midpoint", "[", 
            RowBox[{"jj", "=", 
             RowBox[{"jacobian", " ", "/.", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"vb", "\[Rule]", " ", "int"}], "]"}]}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"Det", "[", "midjac", "]"}], "]"}], "<", 
             RowBox[{"10", "^", 
              RowBox[{"-", "6"}]}]}], ",", " ", 
            RowBox[{"midjac", " ", "=", 
             RowBox[{"thirdpoint", "[", 
              RowBox[{"jj", "=", 
               RowBox[{"jacobian", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"vb", "\[Rule]", " ", "int"}], "]"}]}]}], "]"}]}]}], 
           "]"}], ";", " ", "\[IndentingNewLine]", 
          RowBox[{"Y", "=", 
           RowBox[{"Inverse", "[", "midjac", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"kk", "=", 
           RowBox[{"m", "-", 
            RowBox[{"Y", "  ", ".", " ", 
             RowBox[{"(", 
              RowBox[{"f", " ", "/.", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"vb", " ", "\[Rule]", " ", "m"}], "]"}]}], " ", 
              ")"}]}], "+", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"IdentityMatrix", "[", 
                RowBox[{"Length", "[", "f", "]"}], "]"}], "-", " ", 
               RowBox[{"Y", ".", " ", "jj"}]}], ")"}], ".", 
             RowBox[{"(", 
              RowBox[{"int", "-", "m"}], ")"}]}]}]}], " ", ";", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IntervalContains", "[", 
             RowBox[{"int", ",", " ", "kk"}], "]"}], ",", 
            RowBox[{"!", 
             RowBox[{"FreeQ", "[", 
              RowBox[{
               RowBox[{"intervalintersectionbox", "[", 
                RowBox[{"int", ",", "kk"}], "]"}], ",", " ", 
               RowBox[{"Interval", "[", "]"}]}], "]"}]}], ",", " ", "kk"}], 
           "}"}]}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"KrawczykQ", "[", 
      RowBox[{"f_", ",", " ", "i__List", ",", "jacobian_"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
       ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", "Y", ",", 
           RowBox[{"int", "=", 
            RowBox[{"IteratorListToBox", "[", 
             RowBox[{"{", "i", "}"}], "]"}]}], ",", 
           RowBox[{"vb", " ", "=", " ", 
            RowBox[{"First", " ", "/@", " ", 
             RowBox[{"{", "i", "}"}]}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"midpoint", "[", "int", "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"midjac", "=", 
           RowBox[{"midpoint", "[", 
            RowBox[{"jacobian", " ", "/.", " ", 
             RowBox[{"Thread", "[", 
              RowBox[{"vb", "\[Rule]", " ", "m"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"Det", "[", "midjac", "]"}], "]"}], "<", 
             RowBox[{"10", "^", 
              RowBox[{"-", "6"}]}]}], ",", " ", 
            RowBox[{"midjac", " ", "=", 
             RowBox[{"thirdpoint", "[", 
              RowBox[{"jj", "=", 
               RowBox[{"jacobian", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"vb", "\[Rule]", " ", "int"}], "]"}]}]}], "]"}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Y", "=", 
           RowBox[{"Inverse", "[", "midjac", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"IntervalContains", "[", 
           RowBox[{"int", ",", " ", 
            RowBox[{"m", "-", 
             RowBox[{"Y", "  ", ".", " ", 
              RowBox[{"(", 
               RowBox[{"f", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"vb", " ", "\[Rule]", " ", "m"}], "]"}]}], " ", 
               ")"}]}], "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"IdentityMatrix", "[", 
                 RowBox[{"Length", "[", "f", "]"}], "]"}], "-", " ", 
                RowBox[{"Y", ".", " ", 
                 RowBox[{"(", 
                  RowBox[{"jacobian", " ", "/.", " ", 
                   RowBox[{"Thread", "[", 
                    RowBox[{"vb", " ", "\[Rule]", " ", "int"}], "]"}]}], 
                  ")"}]}]}], ")"}], ".", 
              RowBox[{"(", 
               RowBox[{"int", "-", "m"}], ")"}]}]}]}], "]"}]}]}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NewtonBox", "[", 
      RowBox[{"f_", ",", " ", "i__List", ",", "jacobianinv_"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
       ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", 
           RowBox[{"int", "=", 
            RowBox[{"IteratorListToBox", "[", 
             RowBox[{"{", "i", "}"}], "]"}]}], ",", 
           RowBox[{"vb", " ", "=", " ", 
            RowBox[{"First", " ", "/@", " ", 
             RowBox[{"{", "i", "}"}]}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"midpoint", "[", "int", "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"kk", "=", 
           RowBox[{"m", "-", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"jacobianinv", " ", "/.", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"vb", " ", "\[Rule]", " ", "int"}], "]"}]}], ")"}], 
             ".", 
             RowBox[{"(", 
              RowBox[{"f", " ", "/.", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"vb", " ", "\[Rule]", " ", "m"}], "]"}]}], " ", 
              ")"}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IntervalContains", "[", 
             RowBox[{"int", ",", " ", "kk"}], "]"}], ",", 
            RowBox[{"!", 
             RowBox[{"FreeQ", "[", 
              RowBox[{
               RowBox[{"intervalintersectionbox", "[", 
                RowBox[{"int", ",", "kk"}], "]"}], ",", " ", 
               RowBox[{"Interval", "[", "]"}]}], "]"}]}], ",", " ", "kk"}], 
           "}"}]}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NewtonBoxQ", "[", 
      RowBox[{"f_", ",", " ", "i__List", ",", "jacobianinv_"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
       ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", 
           RowBox[{"int", "=", 
            RowBox[{"IteratorListToBox", "[", 
             RowBox[{"{", "i", "}"}], "]"}]}], ",", 
           RowBox[{"vb", " ", "=", " ", 
            RowBox[{"First", " ", "/@", " ", 
             RowBox[{"{", "i", "}"}]}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"midpoint", "[", "int", "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"IntervalContains", "[", 
           RowBox[{"int", ",", " ", 
            RowBox[{"m", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"jacobianinv", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"vb", " ", "\[Rule]", " ", "int"}], "]"}]}], ")"}], 
              ".", 
              RowBox[{"(", 
               RowBox[{"f", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"vb", " ", "\[Rule]", " ", "m"}], "]"}]}], " ", 
               ")"}]}]}]}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]}]}]], "Input",
 ExpressionUUID -> "5eac8607-5bbf-49f2-9840-53b3e6a1594a"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData["IntervalKrawczyk"],
  ExpressionUUID -> "7e393b5b-d80a-40e7-9dc8-e3a54740016a"],
 ", a needed subroutine for the rootfinding part of Algorithm 4.2"
}], "Subsection",
 ExpressionUUID -> "eefa1710-e76d-4f73-8091-57537b6d74d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IntervalKrawczyk", "::", "usage"}], " ", "=", " ", 
    "\"\<IntervalKrawczyk[f, iters (,opts)] iterates the Krawczyk operator on \
the given box.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "IntervalKrawczyk", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"WorkingPrecision", "\[Rule]", "MachinePrecision"}], ",", 
      RowBox[{"AccuracyGoal", "\[Rule]", "6"}], ",", 
      RowBox[{"MaxIterations", "\[Rule]", "40"}], ",", 
      RowBox[{"CheckUniqueness", "\[Rule]", "False"}], ",", 
      RowBox[{"Jacobian", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
      RowBox[{"EvaluationCount", "\[Rule]", "0"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IntervalKrawczyk", "[", 
    RowBox[{"f_", ",", "iters__List", ",", "opts___Rule"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
     ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t", ",", 
         RowBox[{"count", "=", "0"}], ",", "ag", ",", "wp", ",", "maxiter", 
         ",", "cuQ", ",", "tol", ",", "det", ",", "der", ",", "invder", ",", 
         "invderinterval", ",", "temp", ",", "Xans", ",", "pp", ",", "fail", 
         ",", "start", ",", "uvbles", ",", "vbles", ",", "kk"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "ag", ",", "wp", ",", "maxiter", ",", "cuQ", ",", " ", "der", ",", 
           " ", "ec"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "AccuracyGoal", ",", "WorkingPrecision", ",", "MaxIterations", 
             ",", "CheckUniqueness", ",", " ", "Jacobian", ",", " ", 
             "EvaluationCount"}], "}"}], "/.", "\[InvisibleSpace]", 
           RowBox[{"{", "opts", "}"}]}], "/.", "\[InvisibleSpace]", 
          RowBox[{"Options", "[", "IntervalKrawczyk", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fcount", "=", "ec"}], ";", "\[IndentingNewLine]", 
        RowBox[{"fff", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"ListQ", "[", "f", "]"}]}], ",", 
           RowBox[{"{", "f", "}"}], ",", "f"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Xans", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{
           RowBox[{"IteratorListToBox", "[", 
            RowBox[{"{", "iters", "}"}], "]"}], ",", "wp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"uvbles", "=", 
         RowBox[{"First", "/@", 
          RowBox[{"{", "iters", "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dim", "=", 
         RowBox[{"Length", "[", "vbles", "]"}]}], ";", 
        RowBox[{"tol", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", "ag"}]]}], ";", "\[IndentingNewLine]", 
        RowBox[{"fail", "=", "False"}], ";", 
        RowBox[{"count", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"deriv", "  ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"der", " ", "===", " ", "Automatic"}], " ", ")"}], "||", 
            " ", "cuQ"}], " ", ",", " ", "\[IndentingNewLine]", "    ", 
           RowBox[{"Transpose", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                SubscriptBox["\[PartialD]", "#"], "fff"}], "&"}], ")"}], "/@",
              "uvbles"}], "]"}], ",", " ", "der"}], " ", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"cuQ", ",", 
          RowBox[{"det", "=", 
           RowBox[{"Det", "[", "deriv", "]"}]}]}], "]"}], ";", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"count", "++"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"count", "<", "maxiter"}], "&&", 
            RowBox[{"FreeQ", "[", 
             RowBox[{"Xans", ",", 
              RowBox[{"Interval", "[", "]"}]}], "]"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{"fff", " ", "/.", " ", 
                  RowBox[{"Thread", "[", 
                   RowBox[{"uvbles", "\[Rule]", "Xans"}], "]"}]}], "]"}], " ",
                 ">", " ", "tol"}], " ", ")"}], "||", "     ", 
              RowBox[{"(", 
               RowBox[{"Or", "@@", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Subtract", "@@", 
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}]}], ">", "tol"}], "&"}], ")"}],
                  "/@", "Xans"}]}], ")"}], "||", 
              RowBox[{"If", "[", 
               RowBox[{"cuQ", ",", 
                RowBox[{"containszeronumber", "[", 
                 RowBox[{"det", "/.", "\[InvisibleSpace]", 
                  RowBox[{"Thread", "[", 
                   RowBox[{"ubles", "\[Rule]", "Xans"}], "]"}]}], "]"}], ",", 
                "False"}], "]"}]}], ")"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"kk", "=", 
            RowBox[{"Krawczyk", "[", 
             RowBox[{"fff", ",", " ", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"rectToIteratorList", "[", 
                RowBox[{"Xans", ",", " ", "uvbles"}], "]"}]}], ",", " ", 
              "deriv"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"fcount", "+=", " ", 
            RowBox[{"dim", "^", "2"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Xans", "=", 
            RowBox[{"intervalintersectionbox", "[", 
             RowBox[{"Xans", ",", 
              RowBox[{"kk", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"fail", ",", "$Failed", ",", "Xans"}], "]"}]}]}], "]"}]}], 
    "]"}]}], ";"}]}], "Input",
 ExpressionUUID -> "958072f7-d112-45f7-96eb-998d0360e01a"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Algorithm 4.2: ",
 Cell[BoxData["IntervalMinimize"],
  ExpressionUUID -> "d10d23a8-92e3-43f5-a71e-a0285a821b51"]
}], "Subsection",
 ExpressionUUID -> "6ea6cb80-63f3-403f-9859-f8d492d5f328"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OpportunisticEvaluations", "::", "usage"}], " ", "=", " ", 
    "\"\<OpportunisticEvaluations is an option to IntervalMinimize that \
checks f-values on the center of each box and lowers the bound accordingly. \
When this technique is used, the result will be an interval containing the \
absolute minimum on the domain, instead of the lowest critical point, since \
these evaluations can find values below the critical points.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ShowRectangles", "::", "usage"}], " ", "=", " ", 
    "\"\<ShowRectangles is an option to some interval algorithm functions \
that works only in dimension 2 and causes the rectangles at each stage of the \
algorithm to be shown, and stored as im[level]. The storage makes for easy \
generation of art as in Figure 4.5 in the book.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UseIntervalKrawczykWhenOneBoxLeft", "::", "usage"}], " ", "=", 
    " ", "\"\<UseIntervalKrawczykWhenOneBoxLeft is an option to \
IntervalMinimize that causes an interval root-finding method on the gradient \
to be used when only one interval remains. This speeds convergence.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TraceQ", "::", "usage"}], " ", "=", " ", 
    "\"\<TraceQ is an option to several functions that causes various \
messages showing the progress of the computation to be printed.\>\""}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IntervalMinimize", "::", "nocp"}], "=", " ", 
    "\"\<There is no critical point in the domain. Try setting CheckGradient \
to False to turn off this search.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IntervalMinimize", "::", "maxlev"}], "=", " ", 
    "\"\<The MaxIterations bound has been exceeded, and so the accuracy goal \
is likely not met.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MergeTolerance", "::", "usage"}], " ", "=", " ", 
    "\"\<MergeTolerance is an option to certain interval-algorithm functions \
that merges neighboring intervals when their diameter is less than the \
tolerance.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FormatIntervalsNicely", "::", "usage"}], " ", "=", " ", 
    "\"\<FormatIntervalsNicely is an option to certain interval-algorithm \
functions that formats the intervals in the output in a sub-super-script \
form.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CheckGradient", "::", "usage"}], " ", "=", " ", 
    "\"\<CheckGradient is an option to IntervalMinimize that causes intervals \
that cannot contain a critical point to be discarded.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ProofBound", "::", "usage"}], "=", "\[IndentingNewLine]", 
    "\"\<Set the lower bound at which the the minimum is satisfactory.\>\""}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "IntervalMinimize", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MaxIterations", "\[Rule]", " ", "30"}], ",", " ", 
      RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", "MachinePrecision"}], 
      ",", " ", 
      RowBox[{"AccuracyGoal", " ", "\[Rule]", " ", "6"}], ",", " ", 
      RowBox[{"TraceQ", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"MergeTolerance", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"OpportunisticEvaluations", " ", "\[Rule]", "False"}], ",", " ",
       "\[IndentingNewLine]", " ", 
      RowBox[{"CheckGradient", "\[Rule]", "True"}], ",", " ", 
      RowBox[{"ShowRectangles", " ", "\[Rule]", "False"}], ",", " ", 
      RowBox[{"UseIntervalKrawczykWhenOneBoxLeft", "\[Rule]", "True"}], ",", 
      "   ", 
      RowBox[{"FontSize", "\[Rule]", "9"}], ",", " ", 
      RowBox[{"FormatIntervalsNicely", "\[Rule]", "True"}], ",", " ", 
      RowBox[{"ProofBound", "\[Rule]", 
       RowBox[{"10", "^", 
        RowBox[{"-", "6"}]}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IntervalMinimize", "[", 
    RowBox[{"f_", ",", "iters__List", ",", 
     RowBox[{"givenmin_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "\[Equal]", "\[Infinity]"}], " ", "||", 
          RowBox[{"NumericQ", "[", "#", "]"}]}], ")"}], "&"}], ")"}]}], ",", 
     "opts___"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Experimental`$EqualTolerance", " ", "=", " ", "0"}], "}"}], 
     ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "uvbles", ",", " ", "vbles", ",", "dim", " ", ",", "kk", ",", "wp"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "wp", ",", " ", "maxlev", ",", "ag", ",", "trQ", ",", " ", "mtol", 
           ",", " ", "oppQ", ",", "inQ", ",", " ", "cgQ", ",", " ", "artQ", 
           ",", "fs", ",", " ", "formQ", ",", " ", "pf"}], "}"}], " ", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "WorkingPrecision", ",", "MaxIterations", ",", "  ", 
             "AccuracyGoal", ",", "TraceQ", ",", " ", "MergeTolerance", ",", 
             " ", "OpportunisticEvaluations", ",", " ", "\[IndentingNewLine]",
              "UseIntervalKrawczykWhenOneBoxLeft", ",", "CheckGradient", ",", 
             " ", "ShowRectangles", ",", "\[IndentingNewLine]", "FontSize", 
             ",", " ", "FormatIntervalsNicely", ",", " ", "ProofBound"}], 
            "}"}], " ", "/.", " ", 
           RowBox[{"{", "opts", "}"}]}], " ", "/.", " ", 
          RowBox[{"Options", "[", "IntervalMinimize", "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"hf", " ", "=", " ", 
         RowBox[{"HoldForm", "[", 
          RowBox[{"IntervalMinimize", "[", 
           RowBox[{"f", ",", "iters", ",", "givenmin", ",", "opts"}], "]"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rects", "=", 
         RowBox[{"N", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Interval", " ", "/@", " ", 
             RowBox[{"Rest", " ", "/@", " ", 
              RowBox[{"{", "iters", "}"}]}]}], "}"}], ",", "wp"}], "]"}]}], 
        ";", 
        RowBox[{"fcount", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ends", " ", "=", " ", 
         RowBox[{
          RowBox[{"rects", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
          RowBox[{
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{"i_", ",", " ", "j_"}], "}"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Interval", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "\[Infinity]"}], ",", " ", "i"}], "}"}], "]"}], 
             ",", " ", 
             RowBox[{"Interval", "[", 
              RowBox[{"{", 
               RowBox[{"j", ",", "\[Infinity]"}], "}"}], "]"}]}], "}"}]}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"borderQ", "[", 
          RowBox[{"{", "ii__Interval", "}"}], "]"}], " ", ":=", " ", 
         RowBox[{"Or", " ", "@@", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", 
               RowBox[{
                RowBox[{"{", "ii", "}"}], "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], " ", ">=", " ", 
              RowBox[{"Min", "[", " ", 
               RowBox[{"ends", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "2"}], "]"}], "]"}], "]"}]}], " ", "||", 
             " ", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"{", "ii", "}"}], "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], " ", "<=", " ", 
              RowBox[{"Max", "[", " ", 
               RowBox[{"ends", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "1"}], "]"}], "]"}], "]"}]}]}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"j", ",", " ", 
              RowBox[{"Length", "[", "ends", "]"}]}], "}"}]}], "]"}]}]}], " ",
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"exterior", " ", "=", " ", 
         RowBox[{"rects", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"smallstage", " ", "=", " ", "False"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vbles", " ", "=", " ", 
         RowBox[{"Unique", " ", "/@", " ", 
          RowBox[{"First", " ", "/@", " ", 
           RowBox[{"{", "iters", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"uvbles", " ", "=", " ", 
         RowBox[{"First", " ", "/@", " ", 
          RowBox[{"{", "iters", "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dim", "=", 
         RowBox[{"Length", "[", "uvbles", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dim", " ", "\[LessEqual]", " ", "2"}], ",", " ", 
          RowBox[{"ccQ", "=", "False"}]}], "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Clear", "[", 
         RowBox[{"fcn", ",", "gradf"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fcn", "[", 
          RowBox[{"m_:", "\[Infinity]"}], "]"}], ":=", 
         RowBox[{"Function", "[", 
          RowBox[{"zz", ",", 
           RowBox[{"(", 
            RowBox[{"N", "[", 
             RowBox[{
              RowBox[{"f", "/.", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"uvbles", "\[Rule]", " ", "zz"}], "]"}]}], ",", "m"}],
              "]"}], ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"gradf", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Pattern", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Blank", "[", "]"}]}], "]"}], "&"}], " ", "/@", " ", 
           "vbles"}], "]"}], " ", ":=", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"(", "\[IndentingNewLine]", "  ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{"f", ",", "#"}], "]"}], "&"}], "/@", " ", "uvbles"}], 
             ")"}], "/.", 
            RowBox[{"Thread", "[", 
             RowBox[{"uvbles", "\[Rule]", " ", "vbles"}], "]"}]}], ")"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"inQ", ",", " ", 
          RowBox[{
           RowBox[{"hessian", "=", 
            RowBox[{"Transpose", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"D", "[", 
                 RowBox[{
                  RowBox[{"gradf", " ", "[", "uvbles", "]"}], ",", "#"}], 
                 "]"}], "&"}], "/@", " ", "uvbles"}], ")"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"invder", "=", 
            RowBox[{"Inverse", "[", "hessian", "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"ansmax", "=", 
         RowBox[{"N", "[", 
          RowBox[{"givenmin", ",", "wp"}], "]"}]}], ";", " ", 
        RowBox[{"ansmin", " ", "=", " ", 
         RowBox[{"-", "\[Infinity]"}]}], ";", " ", 
        RowBox[{"lev", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"rectcount", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"rects", " ", "\[NotEqual]", " ", 
            RowBox[{"{", "}"}]}], " ", "&&", 
           RowBox[{
            RowBox[{"ansmax", "-", "ansmin"}], ">", 
            RowBox[{"10", "^", 
             RowBox[{"-", "ag"}]}]}], " ", "&&", " ", 
           RowBox[{"lev", " ", "\[LessEqual]", " ", "maxlev"}], "&&", 
           RowBox[{"ansmin", "<", "pf"}]}], ",", 
          RowBox[{
           RowBox[{"lev", "++"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dim", "\[Equal]", "2"}], " ", "&&", " ", "artQ"}], ",", 
             RowBox[{
              RowBox[{"im", "[", "lev", "]"}], "=", 
              RowBox[{"Print", "@", 
               RowBox[{"ShowIntervals", "[", 
                RowBox[{"rects", 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"FilterOptions", "[", 
                    RowBox[{"Graphics", ",", "opts"}], "]"}]}], "*)"}], ",", 
                 " ", 
                 RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", " ", 
                 RowBox[{"Frame", "\[Rule]", "True"}], ",", 
                 RowBox[{"PlotRange", " ", "\[Rule]", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Rest", "[", 
                    RowBox[{
                    RowBox[{"{", "iters", "}"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
                    RowBox[{"Rest", "[", 
                    RowBox[{
                    RowBox[{"{", "iters", "}"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"TextStyle", "\[Rule]", 
                  RowBox[{"FontSize", "\[Rule]", "fs"}]}], ",", " ", 
                 RowBox[{"PlotLabel", "\[Rule]", 
                  RowBox[{"StringForm", "[", 
                   RowBox[{"\"\<Bound = ``\>\"", ",", " ", 
                    RowBox[{"NumberForm", "[", 
                    RowBox[{"ansmax", ",", "5"}], "]"}]}], "]"}]}]}], 
                "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"rects", "=", 
            RowBox[{"Join", " ", "@@", " ", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"subdivide", "[", 
                 RowBox[{"#", ",", "wp"}], "]"}], "&"}], ",", "rects"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"fvals", " ", "=", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{"fcn", "[", "wp", "]"}], ",", "rects"}], "]"}]}], ";", 
           " ", 
           RowBox[{"fcount", " ", "+=", " ", 
            RowBox[{"Length", "[", "rects", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"trQ", ",", " ", 
             RowBox[{"rectcount", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{"rectcount", ",", " ", 
                RowBox[{"Length", "[", "rects", "]"}]}], "}"}]}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"ansmax", " ", "=", " ", 
            RowBox[{"If", "[", 
             RowBox[{"oppQ", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "if", " ", "requested", " ", "do", " ", "a", " ", "filtering", 
                " ", "evaluation", " ", "to", " ", "try", " ", "to", " ", 
                "improve", " ", "ansmax"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ansmax", " ", "=", " ", 
               RowBox[{"Min", "[", 
                RowBox[{"ansmax", ",", "\[IndentingNewLine]", " ", 
                 RowBox[{"Min", "[", 
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"fcn", "[", "wp", "]"}], "[", "#", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], " ", "&"}], ",", " ", 
                    
                    RowBox[{"rects", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{"Interval", "[", 
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "b_"}], "}"}], "]"}], "\[RuleDelayed]",
                     " ", 
                    RowBox[{"Interval", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"a", "+", "b"}], ")"}], "/", "2"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"a", "+", "b"}], ")"}], "/", "2"}]}], "}"}], 
                    "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Min", "[", 
               RowBox[{"ansmax", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{"fvals", "/.", " ", 
                  RowBox[{
                   RowBox[{"Interval", "[", 
                    RowBox[{"{", 
                    RowBox[{"_", ",", " ", "m_"}], "}"}], "]"}], ":>", " ", 
                   "m"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Delete", " ", "based", " ", "on", " ", "size"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"fvals", ",", 
               RowBox[{
                RowBox[{"Interval", "[", 
                 RowBox[{"{", 
                  RowBox[{"m_", ",", "_"}], "}"}], "]"}], "/;", " ", 
                RowBox[{"m", " ", "\[LessEqual]", " ", "ansmax"}]}]}], "]"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"rects", "=", " ", 
            RowBox[{
            "rects", "\[LeftDoubleBracket]", "pos", 
             "\[RightDoubleBracket]"}]}], ";", " ", 
           RowBox[{"fvals", "=", " ", 
            RowBox[{
            "fvals", "\[LeftDoubleBracket]", "pos", 
             "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"cgQ", ",", " ", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "delete", " ", "based", " ", "on", " ", "whether", " ", 
                "gradient", " ", "has", " ", "a", " ", "zero"}], ";", " ", 
               RowBox[{"keep", " ", "border", " ", "boxes"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"pos", "=", 
               RowBox[{"Flatten", " ", "[", 
                RowBox[{"Position", "[", "\[IndentingNewLine]", 
                 RowBox[{"rects", ",", 
                  RowBox[{
                   RowBox[{"{", "ii__Interval", "}"}], " ", "/;", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"borderQ", "[", 
                    RowBox[{"{", "ii", "}"}], "]"}], " ", "||", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"fcount", "+=", "  ", "dim"}], ";", 
                    RowBox[{"containszerovector", "[", 
                    RowBox[{"gradf", "[", 
                    RowBox[{"{", "ii", "}"}], "]"}], "]"}]}], ")"}]}], 
                    ")"}]}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"rects", "=", 
               RowBox[{
               "rects", "\[LeftDoubleBracket]", "pos", 
                "\[RightDoubleBracket]"}]}], ";", 
              RowBox[{"fvals", "=", 
               RowBox[{
               "fvals", "\[LeftDoubleBracket]", "pos", 
                "\[RightDoubleBracket]"}]}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", " ", 
           RowBox[{"(*", " ", 
            RowBox[{"improve", " ", "ansmin"}], " ", "*)"}], "  ", 
           RowBox[{"(*", " ", 
            RowBox[{"pos", " ", "can", " ", "NEVER", " ", "be", " ", 
             RowBox[{"empty", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"pos", "\[NotEqual]", " ", 
              RowBox[{"{", "}"}]}], ",", 
             RowBox[{"ansmin", " ", "=", " ", 
              RowBox[{"Min", "[", "fvals", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "if", " ", "there", " ", "is", " ", "one", " ", "box", " ", 
              "left"}], ",", " ", 
             RowBox[{"try", " ", "to", " ", "use", " ", "rootfinding"}]}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"inQ", " ", "&&", " ", 
              RowBox[{
               RowBox[{"Length", "[", "rects", "]"}], "==", "1"}], " ", "&&", 
              " ", 
              RowBox[{"lev", " ", ">", " ", "1"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"test", "=", " ", 
               RowBox[{"Krawczyk", "[", 
                RowBox[{
                 RowBox[{"gradf", "[", "uvbles", "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"Sequence", " ", "@@", "  ", 
                   RowBox[{"rectToIteratorList", "[", 
                    RowBox[{
                    RowBox[{"rects", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", "uvbles"}], 
                    "]"}]}], "]"}], ",", "hessian"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"test", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"ans", "=", "\[IndentingNewLine]", 
                  RowBox[{"IntervalKrawczyk", "[", 
                   RowBox[{
                    RowBox[{"gradf", "[", "uvbles", "]"}], ",", " ", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"rectToIteratorList", "[", 
                    RowBox[{
                    RowBox[{"test", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", " ", "uvbles"}], 
                    "]"}]}], "]"}], ",", 
                    RowBox[{"Jacobian", "\[Rule]", "hessian"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"WorkingPrecision", "\[Rule]", "wp"}], ",", " ", 
                    RowBox[{"AccuracyGoal", " ", "\[Rule]", " ", "ag"}], ",", 
                    " ", 
                    RowBox[{"EvaluationCount", "\[Rule]", "fcount"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Return", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"fcn", "[", "wp", "]"}], "[", "ans", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Thread", "[", 
                    RowBox[{"uvbles", " ", "\[Rule]", " ", "#"}], "]"}], 
                    "&"}], " ", "/@", "  ", 
                    RowBox[{"{", " ", "ans", "}"}]}]}], "}"}], " ", "/.", " ", 
                   RowBox[{"z_Interval", " ", "\[RuleDelayed]", " ", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    "formQ", ",", "IntervalForm", ",", " ", "Identity"}], 
                    "]"}], "[", "z", "]"}]}]}], "]"}]}]}], "]"}]}]}], "]"}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"trQ", ",", " ", 
             RowBox[{"Print", "[", 
              RowBox[{"StringForm", "[", 
               RowBox[{
               "\"\<Finished round ``; `` < answer < ``; `` rectangles to be \
subdivided\>\"", ",", "lev", ",", 
                RowBox[{"NumberForm", "[", 
                 RowBox[{"ansmin", ",", "ag"}], "]"}], ",", " ", 
                RowBox[{"NumberForm", "[", " ", 
                 RowBox[{"ansmax", ",", "ag"}], "]"}], ",", "  ", 
                RowBox[{"Length", "[", "rects", "]"}]}], "]"}], "]"}]}], 
            "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        StyleBox["\[IndentingNewLine]",
         FontWeight->"Plain"], 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "mtol", "]"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"Length", "[", "rects", "]"}], " ", ">", " ", "1"}], " ", 
           "&&", " ", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"diam", "/@", " ", "rects"}], "]"}], " ", "<", " ", 
            "mtol"}]}], ",", " ", 
          RowBox[{"rects", " ", "=", " ", 
           RowBox[{"FixedPoint", "[", 
            RowBox[{"combine", ",", " ", "rects"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"trQ", ",", " ", 
          RowBox[{"Print", "[", "\[IndentingNewLine]", 
           RowBox[{"StringForm", "[", 
            RowBox[{
            "\"\<Finished; no. of current boxes = ``, total rects = ``, ``; \
total function evals = ``\>\"", ",", 
             RowBox[{
              RowBox[{"Length", "[", "rects", "]"}], "+", 
              RowBox[{"Length", "[", "smallrects", "]"}]}], ",", 
             RowBox[{"Flatten", "[", " ", "rectcount", "]"}], ",", " ", 
             RowBox[{"Plus", " ", "@@", " ", 
              RowBox[{"Flatten", "[", "rectcount", "]"}]}], ",", " ", 
             "fcount"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"lev", ">", "maxlev"}], ",", " ", 
          RowBox[{"Message", "[", 
           RowBox[{"IntervalMinimize", "::", "maxlev"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Interval", "[", 
            RowBox[{"{", 
             RowBox[{"ansmin", ",", " ", "ansmax"}], "}"}], "]"}], " ", ",", 
           " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"uvbles", " ", "\[Rule]", " ", "#"}], "]"}], "&"}], " ",
             "/@", " ", "rects"}]}], "}"}], "/.", " ", 
         RowBox[{"z_Interval", " ", "\[RuleDelayed]", " ", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"formQ", ",", "IntervalForm", ",", " ", "Identity"}], 
            "]"}], "[", "z", "]"}]}]}]}]}], "]"}]}], "]"}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.708944282801414*^9, 3.708944288522423*^9}, {
   3.708944922397163*^9, 3.708944970979899*^9}, {3.7089452719134274`*^9, 
   3.708945272897143*^9}, 3.7089475074446163`*^9, {3.7089475735807133`*^9, 
   3.7089475855571337`*^9}, {3.708947616611738*^9, 3.70894764406609*^9}, {
   3.7089484860387163`*^9, 3.708948489531588*^9}},
 ExpressionUUID -> "26bce588-46f1-4e6a-8404-c55be6d63717"]
}, Open  ]]
},
WindowSize->{1102, 884},
WindowMargins->{{Automatic, 59}, {23, Automatic}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (July 28, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 538, 13, 49, "Text"],
Cell[CellGroupData[{
Cell[1121, 37, 237, 4, 64, "Section",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[1361, 43, 21123, 583, 1858, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}]
}, Closed]],
Cell[CellGroupData[{
Cell[22521, 631, 102, 1, 36, "Subsection"],
Cell[22626, 634, 201, 4, 30, "Text"],
Cell[22830, 640, 10576, 259, 873, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[33443, 904, 255, 5, 38, "Subsection"],
Cell[33701, 911, 6399, 152, 585, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[40137, 1068, 207, 5, 38, "Subsection"],
Cell[40347, 1075, 27790, 622, 2574, "Input"]
}, Open  ]]
}
]
*)

